<!DOCTYPE html>
<html>
<head>
  <script src="../lib/utils.js"></script>
  <script src="../lib/mse.js"></script>
</head>
<body>
  <video id="video" controls preload="none"></video>
  <script type="text/javascript">
    checkTestCaseAPI();

var counter = 0;


    var video = document.getElementById("video");

    //video.oncanplay = ()=>{console.log("CAN PLAY");}
//    video.onloadedmetadata = ()=>{console.log("METADATA LOADED"); video.currentTime = 0.0; }
    video.onload = ()=>{console.log("ON LOAD");}
    video.onloadeddata = ()=>{console.log("ON loaded data");}
    video.oncanplaythrough = ()=>{console.log("ON can play through");}

    videoUrl = _params["url"];
    if (!videoUrl)
      videoUrl = "../media/yt_car_video.mp4";
    console.log("MSE video url: " + videoUrl);

   // runSingletest();

function runSingleTest() {
    prepareMSE(video, videoUrl, () => {
      //video.ontimeupdate = () => {
     //   if (video.currentTime > 1) {
          //resetFailTimeout();
        //  video.ontimeupdate = null;
          startTesting();
      //}
     // }
//      failTimeout(5, "Video did not reach 1s currentTime in 5 sec");
//      video.play();
    });
}
 
function startTesting() {
      console.log("START TEST");
      
      video.currentTime = 0.0;

      setTimeout(()=>{video.play();}, 4000);
      failTimeout(10, "Test failed in try: " + counter);
      video.ontimeupdate = () => {
        if (video.currentTime > 2) {
          video.ontimeupdate = null;
          resetFailTimeout();
          video.src = null;
          if (++counter > 50) {
            reportPass();
          } else {
            setTimeout(()=>{ runSingleTest();}, 5000);
          }
        }
      }

      // video.ontimeupdate = () => {
      //   if (video.currentTime > 4) {
      //     console.log("video reached 5sec");
      //     resetFailTimeout();
      //     video.ontimeupdate = null;

      //     setTimeout(() => {

      //     }, 1000)
      //   }
      //   console.log("video paused");
      //   resetFailTimeout();
      //   video.ontime
      // };
      // failTimeout(10, "video didn't resume after seek");
      // video.currentTime = 3;
    }

    runSingleTest();
  </script>
</body>
</html>
